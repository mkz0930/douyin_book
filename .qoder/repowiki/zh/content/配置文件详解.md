# 配置文件详解

<cite>
**本文档引用的文件**
- [config.py](file://src/config.py)
- [main.py](file://src/main.py)
- [llm_client.py](file://src/llm_client.py)
- [tts_client.py](file://src/tts_client.py)
- [video_gen.py](file://src/video_gen.py)
- [image_client.py](file://src/image_client.py)
- [README.md](file://README.md)
</cite>

## 目录
1. [配置系统概述](#配置系统概述)
2. [环境变量与敏感信息管理](#环境变量与敏感信息管理)
3. [src/config.py 可配置项详解](#srcconfigpy-可配置项详解)
4. [配置优先级说明](#配置优先级说明)
5. [最佳实践建议](#最佳实践建议)

## 配置系统概述

本项目采用分层配置系统，结合环境变量和代码内配置，实现灵活且安全的参数管理。系统通过 `python-dotenv` 库加载 `.env` 文件中的环境变量，确保敏感信息（如 API 密钥）与代码分离。核心配置集中于 `src/config.py` 文件，该文件定义了 LLM、图像生成、TTS 等模块的默认参数和行为。主程序 `main.py` 在启动时初始化所有客户端，并根据配置执行自动化流程，包括脚本生成、图像生成、语音合成、视频合成和自动上传。

**Section sources**
- [config.py](file://src/config.py#L1-L93)
- [main.py](file://src/main.py#L1-L262)
- [README.md](file://README.md#L1-L134)

## 环境变量与敏感信息管理

项目使用 `.env` 文件来管理所有敏感信息和 API 密钥，这是安全实践的核心。`.env` 文件被 `.gitignore` 忽略，防止密钥意外提交到版本控制系统。

### 环境变量加载机制

配置系统在 `src/config.py` 的开头通过 `from dotenv import load_dotenv` 和 `load_dotenv()` 语句加载环境变量。此操作会自动读取项目根目录下的 `.env` 文件，并将其中的键值对注入到运行时的 `os.environ` 中。随后，代码通过 `os.getenv("VARIABLE_NAME", "default_value")` 来读取这些变量。

### 关键环境变量

以下环境变量应在 `.env` 文件中定义：

- **LLM_API_KEY**: 用于访问大语言模型（如 SiliconFlow）的 API 密钥。这是生成脚本和绘画提示词所必需的。
- **LLM_BASE_URL**: LLM 服务的 API 基础 URL。默认为 `https://api.siliconflow.cn/v1`，可根据不同提供商进行更改。
- **LLM_MODEL**: 指定要使用的 LLM 模型名称。默认为 `Qwen/Qwen2.5-7B-Instruct`。
- **HF_TOKEN**: Hugging Face 的访问令牌。虽然不是强制要求，但拥有此令牌可以提高图像生成服务的速率限制，避免被限流。
- **IMAGE_MODEL**: 指定用于图像生成的模型。默认为 `stabilityai/stable-diffusion-xl-base-1.0`。

**Section sources**
- [config.py](file://src/config.py#L1-L18)
- [.gitignore](file://.gitignore#L2)
- [README.md](file://README.md#L34-L38)

## src/config.py 可配置项详解

`src/config.py` 是项目的中央配置文件，定义了所有可配置的参数。以下是其内容的详细分类说明。

### LLM 参数配置

这部分配置控制大语言模型的行为，用于生成视频脚本和绘画提示词。

| 配置项 | 类型 | 默认值 | 说明 |
| :--- | :--- | :--- | :--- |
| `API_KEY` | 环境变量 | `LLM_API_KEY` | LLM 服务的认证密钥，必须在 `.env` 文件中设置。 |
| `BASE_URL` | 环境变量 | `https://api.siliconflow.cn/v1` | LLM API 的基础地址。 |
| `MODEL_NAME` | 环境变量 | `Qwen/Qwen2.5-7B-Instruct` | 要调用的 LLM 模型名称。 |
| `SCRIPT_GENERATION_PROMPT` | 字符串 | (长文本) | 用于将书籍内容转化为抖音口播脚本的系统提示词。定义了“黄金3秒”开头、内容结构、语言风格等要求。 |
| `SCRIPT_GENERATION_FROM_SUMMARY_PROMPT` | 字符串 | (长文本) | 当书籍内容过短时，用于根据网络搜索摘要生成脚本的提示词。 |
| `IMAGE_PROMPT_GENERATION_PROMPT` | 字符串 | (长文本) | 用于根据脚本片段生成英文绘画提示词的提示词。 |

**Section sources**
- [config.py](file://src/config.py#L6-L92)

### 图像生成配置

这部分配置控制 AI 绘画功能。

| 配置项 | 类型 | 默认值 | 说明 |
| :--- | :--- | :--- | :--- |
| `HF_TOKEN` | 环境变量 | `HF_TOKEN` | Hugging Face 访问令牌，用于提高图像生成服务的速率限制。 |
| `IMAGE_MODEL` | 环境变量 | `stabilityai/stable-diffusion-xl-base-1.0` | 用于生成封面/背景图的 AI 模型。 |
| `IMAGE_SIZE` | 字符串 | `1024x1024` | 生成图像的分辨率。 |

**Section sources**
- [config.py](file://src/config.py#L12-L18)
- [image_client.py](file://src/image_client.py#L10-L20)

### TTS 参数配置

这部分配置控制文本转语音（TTS）和字幕生成。

| 配置项 | 类型 | 默认值 | 说明 |
| :--- | :--- | :--- | :--- |
| `TTS_VOICE` | 字符串 | `zh-CN-YunxiNeural` | 语音合成的音色。可选项：`zh-CN-YunxiNeural` (男声), `zh-CN-XiaoxiaoNeural` (女声)。 |
| `TTS_RATE` | 字符串 | `+0%` | 语速。`+0%` 为正常速度，`+10%` 为加快，`-10%` 为减慢。 |
| `TTS_VOLUME` | 字符串 | `+0%` | 音量。`+0%` 为正常音量，`+10%` 为增大，`-10%` 为减小。 |

**Section sources**
- [config.py](file://src/config.py#L20-L23)
- [tts_client.py](file://src/tts_client.py#L7-L18)

### 路径配置

项目通过代码逻辑定义了输入和输出目录，这些路径是硬编码的，但遵循清晰的约定。

| 路径类型 | 路径 | 说明 |
| :--- | :--- | :--- |
| **输入目录** | `data/` | 存放书籍文本文件（`.txt`）、可选的默认背景图（`background.jpg`）和背景音乐（`bgm.mp3` 或 `bgm.wav`）。 |
| **输出目录** | `output/` | 存放所有生成的中间和最终文件，包括脚本、音频、字幕、图片和视频。 |

**Section sources**
- [main.py](file://src/main.py#L71-L74)
- [README.md](file://README.md#L100-L114)

## 配置优先级说明

本项目的配置系统遵循明确的优先级规则，确保灵活性和可覆盖性。

1.  **环境变量优先**：所有通过 `os.getenv()` 读取的配置项（如 `API_KEY`, `MODEL_NAME`）都以环境变量的值为最高优先级。如果在 `.env` 文件或系统环境中设置了该变量，它将覆盖 `config.py` 中可能存在的任何默认值。
2.  **代码默认值次之**：当环境变量未设置时，`os.getenv()` 的第二个参数（即默认值）将被采用。例如，`BASE_URL` 的默认值是 `https://api.siliconflow.cn/v1`，只有在 `LLM_BASE_URL` 环境变量未定义时才会使用。
3.  **硬编码配置**：像 `TTS_VOICE`, `TTS_RATE`, `TTS_VOLUME` 这样的配置是直接在 `config.py` 中定义的常量，没有环境变量覆盖机制。要修改它们，必须直接编辑 `config.py` 文件。

这种设计使得敏感信息和关键服务端点（通过环境变量）易于在不同环境（开发、生产）间切换，而像 TTS 音色这样的偏好设置则作为代码的一部分进行管理。

**Section sources**
- [config.py](file://src/config.py#L8-L10)
- [main.py](file://src/main.py#L55)

## 最佳实践建议

### 不同LLM提供商的配置示例

虽然项目默认使用 SiliconFlow，但其设计允许轻松切换到其他兼容 OpenAI API 格式的提供商。

- **使用 OpenAI**:
  ```env
  LLM_API_KEY=your_openai_api_key_here
  LLM_BASE_URL=https://api.openai.com/v1
  LLM_MODEL=gpt-3.5-turbo
  ```

- **使用其他兼容API的提供商**:
  ```env
  LLM_API_KEY=your_provider_api_key_here
  LLM_BASE_URL=https://api.yourprovider.com/v1
  LLM_MODEL=your_provider_model_name
  ```

只需更改 `LLM_API_KEY`, `LLM_BASE_URL`, 和 `LLM_MODEL` 这三个环境变量即可。

### 安全存储API密钥的方法

1.  **使用 `.env` 文件**：始终将 API 密钥存储在 `.env` 文件中，并确保该文件在 `.gitignore` 中被忽略，防止密钥泄露。
2.  **权限管理**：设置 `.env` 文件的文件系统权限，仅允许必要的用户或进程读取。
3.  **避免硬编码**：绝对不要在 Python 代码中直接写入 API 密钥。
4.  **定期轮换密钥**：对于重要的生产密钥，应定期进行轮换。
5.  **使用密钥管理服务**：在生产环境中，考虑使用 AWS Secrets Manager、Hashicorp Vault 等专业密钥管理服务，而不是 `.env` 文件。

**Section sources**
- [config.py](file://src/config.py#L8-L10)
- [.gitignore](file://.gitignore#L2)
- [README.md](file://README.md#L34-L38)